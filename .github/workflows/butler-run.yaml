# Copyright 2026 The Butler Authors.
# SPDX-License-Identifier: Apache-2.0
#
# PeaaS execution target â€” triggered by butler-portal RunDispatcher
# via GitHub repository_dispatch when a module run is queued in PeaaS mode.
#
# Payload:
#   butler_url:      Portal registry API base URL
#   run_id:          Module run UUID
#   callback_token:  brce_ callback token for authentication
#   operation:       plan | apply | destroy
#   module_name:     Human-readable module name (for logging)

name: Butler Run
on:
  repository_dispatch:
    types: [butler-run]

jobs:
  run:
    runs-on: butler-runners
    timeout-minutes: 30
    steps:
      - name: Run butler-runner
        uses: docker://ghcr.io/butlerdotdev/butler-runner:0.1.0
        env:
          BUTLER_URL: ${{ github.event.client_payload.butler_url }}
          BUTLER_RUN_ID: ${{ github.event.client_payload.run_id }}
          BUTLER_TOKEN: ${{ github.event.client_payload.callback_token }}
        with:
          args: exec
